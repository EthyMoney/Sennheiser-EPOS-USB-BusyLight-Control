const HID = require('node-hid');

const vendorId = 5013; // Sennheiser's vendorId
const productId = 116; // Sennheiser UI 20 BL productId

try {
  const device = new HID.HID(vendorId, productId);
  console.log("Connected to Sennheiser UI 20 BL");

  // Function to send raw data to the device
  function sendPacket(data, description) {
    console.log(`Sending packet for: ${description}`);
    console.log("Packet:", Buffer.from(data).toString('hex'));
    device.write(data);
  }

  // High volume packet
  const highVolumePacket = [
    0x01, 0x04, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  ];

  // Trigger packet
  const triggerPacket = [
    0x01, 0x09, 0x04, 0x01, 0x03, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  ];

  // Play high volume sound
  setTimeout(() => {
    sendPacket(highVolumePacket, "Set High Volume");
    setTimeout(() => sendPacket(triggerPacket, "Trigger High Volume Sound"), 500);
  }, 1000);

  // Clean up
  process.on('exit', () => {
    device.close();
    console.log("Disconnected from device");
  });
} catch (err) {
  console.error("Failed to connect to device:", err.message);
}
